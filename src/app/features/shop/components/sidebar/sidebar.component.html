<!-- Mobile Menu Toggle Button -->
<button class="btn d-lg-none position-fixed mobile-toggle" (click)="toggleMobileMenu()">
    <i class="bi bi-list fs-4"></i>
</button>

<!-- Overlay for mobile -->
<div class="sidebar-overlay d-lg-none" [class.active]="isMobileMenuOpen()" (click)="closeMobileMenu()">
</div>

<!-- Sidebar -->
<aside class="sidebar d-flex flex-column" [class.mobile-open]="isMobileMenuOpen()">
    <!-- Logo Section -->
    <div class="px-3 py-4 border-bottom border-white border-opacity-10">
        <div class="d-flex align-items-center gap-3">
            <div class="logo-icon d-flex align-items-center justify-content-center rounded-3">
                <i class="bi bi-shop fs-4 text-white"></i>
            </div>
            <div>
                <h1 class="h5 mb-0 fw-bold text-white uppercase-tracking">MA BOUTIQUE</h1>
                <small class="text-white-50">Espace Vendeur</small>
            </div>
        </div>
    </div>

    <!-- Navigation Menu -->
    <nav class="flex-grow-1 overflow-auto py-3">
        @for (section of navSections(); track $index) {
        @if (section.title) {
        <div class="px-3 py-2 text-uppercase small text-white-50 fw-semibold letter-spacing">
            {{ section.title }}
        </div>
        }

        <ul class="nav flex-column">
            @for (item of section.items; track item.route) {
            <li class="nav-item">
                @if (item.children) {
                <div class="nav-link d-flex align-items-center px-3 py-2 text-white-50 cursor-pointer"
                    [class.active]="item.isOpen" (click)="toggleSubmenu(item)">
                    <i class="bi {{ item.icon }} me-3 fs-5"></i>
                    <span class="flex-grow-1">{{ item.label }}</span>
                    <i class="bi bi-chevron-down small transition-transform" [class.rotate-180]="item.isOpen"></i>
                </div>
                @if (item.isOpen) {
                <ul class="nav flex-column ms-4 py-1">
                    @for (child of item.children; track child.route) {
                    <li class="nav-item">
                        <a class="nav-link d-flex align-items-center px-3 py-2 text-white-50 small"
                            [routerLink]="child.route" routerLinkActive="active" (click)="closeMobileMenu()">
                            <i class="bi {{ child.icon }} me-3"></i>
                            <span>{{ child.label }}</span>
                        </a>
                    </li>
                    }
                </ul>
                }
                } @else {
                <a class="nav-link d-flex align-items-center px-3 py-2 text-white-50" [routerLink]="item.route"
                    routerLinkActive="active" (click)="closeMobileMenu()">
                    <i class="bi {{ item.icon }} me-3 fs-5"></i>
                    <span class="flex-grow-1">{{ item.label }}</span>
                    @if (item.badge && item.badge > 0) {
                    <span class="badge bg-primary rounded-pill">{{ item.badge }}</span>
                    }
                </a>
                }
            </li>
            }
        </ul>
        }
    </nav>

    <!-- Sidebar Footer - Shop Profile -->
    <div class="p-3 border-top border-white border-opacity-10 mt-auto">
        <div class="dropdown dropup">
            <button class="btn w-100 p-0 border-0 d-flex align-items-center gap-3 p-2 rounded-3 user-profile"
                type="button" (click)="toggleProfileDropdown()" [attr.aria-expanded]="isProfileDropdownOpen()">
                <div class="user-avatar d-flex align-items-center justify-content-center rounded-3">
                    <i class="bi bi-person-fill text-white"></i>
                </div>
                <div class="text-start flex-grow-1">
                    <span class="d-block fw-semibold text-white small text-truncate" style="max-width: 120px;">Vendeur
                        Premium</span>
                    <small class="text-white-50">Gérant</small>
                </div>
                <i class="bi bi-chevron-up text-white-50 transition-transform"
                    [class.rotate-180]="!isProfileDropdownOpen()"></i>
            </button>

            <!-- Dropdown Menu -->
            <div class="dropdown-menu shadow-lg border-0 rounded-3 p-2 w-100" [class.show]="isProfileDropdownOpen()">
                <a class="dropdown-item d-flex align-items-center gap-2 rounded-2 py-2 mb-1" routerLink="/shop/profile"
                    (click)="closeProfileDropdown()">
                    <i class="bi bi-person-circle"></i>
                    <span>Mon Profil</span>
                </a>
                <hr class="dropdown-divider opacity-10">
                <button class="dropdown-item d-flex align-items-center gap-2 rounded-2 py-2 text-danger logout-item"
                    type="button" (click)="logout()">
                    <i class="bi bi-box-arrow-right"></i>
                    <span>Déconnexion</span>
                </button>
            </div>
        </div>
    </div>
</aside>

<!-- Click outside to close dropdown -->
@if (isProfileDropdownOpen()) {
<div class="dropdown-backdrop" (click)="closeProfileDropdown()"></div>
}