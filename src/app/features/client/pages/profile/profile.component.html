<div class="profile-container py-5">
    <div class="container">
        <!-- Header -->
        <div class="row mb-5 animate__animated animate__fadeIn">
            <div class="col-12 d-flex align-items-center justify-content-between">
                <div>
                    <h1 class="display-5 fw-bold text-dark mb-1">Mon Profil</h1>
                    <p class="text-muted">Gérez vos informations personnelles et vos paramètres de sécurité.</p>
                </div>
            </div>
        </div>

        <div class="row g-4">
            <!-- Sidebar Navigation -->
            <div class="col-lg-3 animate__animated animate__fadeInLeft">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden mb-4">
                    <div class="card-body p-4 text-center border-bottom bg-light">
                        <div class="profile-avatar mb-3 mx-auto">
                            <span class="avatar-initials">{{ userData.firstName.charAt(0) }}{{
                                userData.lastName.charAt(0) }}</span>
                        </div>
                        <h5 class="fw-bold mb-0">{{ userData.firstName }} {{ userData.lastName }}</h5>
                        <p class="small text-muted mb-0">{{ userData.email }}</p>
                    </div>
                    <div class="list-group list-group-flush p-2">
                        <button class="list-group-item list-group-item-action border-0 rounded-3 active py-3 px-4 mb-1">
                            <i class="bi bi-person me-3"></i>Informations Personnelles
                        </button>
                        <a routerLink="/client/orders"
                            class="list-group-item list-group-item-action border-0 rounded-3 py-3 px-4 mb-1">
                            <i class="bi bi-box-seam me-3"></i>Mes Commandes
                        </a>
                        <a routerLink="/client/wishlist"
                            class="list-group-item list-group-item-action border-0 rounded-3 py-3 px-4 mb-1">
                            <i class="bi bi-heart me-3"></i>Liste de souhaits
                        </a>
                        <button
                            class="list-group-item list-group-item-action border-0 rounded-3 py-3 px-4 text-danger mb-1">
                            <i class="bi bi-power me-3"></i>Déconnexion
                        </button>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="col-lg-9 animate__animated animate__fadeInRight">
                <!-- Personal Info Card -->
                <div class="card border-0 shadow-sm rounded-4 mb-4">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h5 class="fw-bold mb-0">Informations Personnelles</h5>
                        <hr class="mt-3 mb-0 opacity-10">
                    </div>
                    <div class="card-body p-4">
                        <form [formGroup]="profileForm" (ngSubmit)="onUpdateProfile()">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Prénom</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-person"></i></span>
                                        <input type="text" formControlName="firstName" class="form-control"
                                            [class.is-invalid]="profileForm.get('firstName')?.touched && profileForm.get('firstName')?.invalid">
                                    </div>
                                    @if (profileForm.get('firstName')?.touched && profileForm.get('firstName')?.invalid)
                                    {
                                    <div class="invalid-feedback d-block mt-1">Le prénom est requis.</div>
                                    }
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Nom</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-person"></i></span>
                                        <input type="text" formControlName="lastName" class="form-control"
                                            [class.is-invalid]="profileForm.get('lastName')?.touched && profileForm.get('lastName')?.invalid">
                                    </div>
                                    @if (profileForm.get('lastName')?.touched && profileForm.get('lastName')?.invalid) {
                                    <div class="invalid-feedback d-block mt-1">Le nom est requis.</div>
                                    }
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Adresse
                                        Email</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-envelope"></i></span>
                                        <input type="email" formControlName="email" class="form-control"
                                            [class.is-invalid]="profileForm.get('email')?.touched && profileForm.get('email')?.invalid">
                                    </div>
                                    @if (profileForm.get('email')?.touched && profileForm.get('email')?.invalid) {
                                    <div class="invalid-feedback d-block mt-1">Veuillez entrer une adresse email valide.
                                    </div>
                                    }
                                </div>
                                <div class="col-md-6">
                                    <label
                                        class="form-label small fw-bold text-uppercase text-secondary">Téléphone</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-telephone"></i></span>
                                        <input type="text" formControlName="phone" class="form-control">
                                    </div>
                                </div>
                                <div class="col-12">
                                    <label
                                        class="form-label small fw-bold text-uppercase text-secondary">Adresse</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-geo-alt"></i></span>
                                        <input type="text" formControlName="address" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Ville</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-building"></i></span>
                                        <input type="text" formControlName="city" class="form-control">
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Code
                                        Postal</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-mailbox"></i></span>
                                        <input type="text" formControlName="zipCode" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 pt-2 border-top">
                                <button type="submit" class="btn btn-dark rounded-pill px-5 fw-bold py-2 shadow-sm"
                                    [disabled]="profileForm.invalid || isLoading()">
                                    @if (isLoading()) {
                                    <span class="spinner-border spinner-border-sm me-2"
                                        role="status"></span>Enregistrement...
                                    } @else {
                                    Enregistrer les modifications
                                    }
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Password Security Card -->
                <div class="card border-0 shadow-sm rounded-4">
                    <div class="card-header bg-white border-0 pt-4 px-4 pb-0">
                        <h5 class="fw-bold mb-0">Sécurité du Compte</h5>
                        <p class="small text-muted mb-0">Modifier votre mot de passe pour sécuriser votre accès.</p>
                        <hr class="mt-3 mb-0 opacity-10">
                    </div>
                    <div class="card-body p-4">
                        <form [formGroup]="passwordForm" (ngSubmit)="onUpdatePassword()">
                            <div class="row g-3">
                                <div class="col-md-12">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Mot de passe
                                        actuel</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-shield-lock"></i></span>
                                        <input [type]="showPassword() ? 'text' : 'password'"
                                            formControlName="currentPassword" class="form-control"
                                            [class.is-invalid]="passwordForm.get('currentPassword')?.touched && passwordForm.get('currentPassword')?.invalid"
                                            placeholder="Mot de passe actuel">
                                        @if (!(passwordForm.get('currentPassword')?.touched &&
                                        passwordForm.get('currentPassword')?.invalid)) {
                                        <button type="button" (click)="togglePasswordVisibility('current')"
                                            class="btn-toggle-pass" tabindex="-1">
                                            <i class="bi" [class.bi-eye]="!showPassword()"
                                                [class.bi-eye-slash]="showPassword()"></i>
                                        </button>
                                        }
                                    </div>
                                    @if (passwordForm.get('currentPassword')?.touched &&
                                    passwordForm.get('currentPassword')?.invalid) {
                                    <div class="invalid-feedback d-block mt-1">Le mot de passe actuel est requis.</div>
                                    }
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Nouveau mot de
                                        passe</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-key-fill"></i></span>
                                        <input [type]="showNewPassword() ? 'text' : 'password'"
                                            formControlName="newPassword" class="form-control"
                                            [class.is-invalid]="passwordForm.get('newPassword')?.touched && passwordForm.get('newPassword')?.invalid"
                                            placeholder="Nouveau mot de passe">
                                        @if (!(passwordForm.get('newPassword')?.touched &&
                                        passwordForm.get('newPassword')?.invalid)) {
                                        <button type="button" (click)="togglePasswordVisibility('new')"
                                            class="btn-toggle-pass" tabindex="-1">
                                            <i class="bi" [class.bi-eye]="!showNewPassword()"
                                                [class.bi-eye-slash]="showNewPassword()"></i>
                                        </button>
                                        }
                                    </div>
                                    @if (passwordForm.get('newPassword')?.touched &&
                                    passwordForm.get('newPassword')?.invalid) {
                                    <div class="invalid-feedback d-block mt-1">Le mot de passe doit contenir au moins 6
                                        caractères.</div>
                                    }
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label small fw-bold text-uppercase text-secondary">Confirmer le
                                        nouveau mot de passe</label>
                                    <div class="input-group-premium">
                                        <span class="input-icon"><i class="bi bi-shield-check"></i></span>
                                        <input [type]="showConfirmPassword() ? 'text' : 'password'"
                                            formControlName="confirmPassword" class="form-control"
                                            [class.is-invalid]="(passwordForm.get('confirmPassword')?.touched && (passwordForm.get('confirmPassword')?.invalid || passwordForm.hasError('mismatch')))"
                                            placeholder="Confirmer le mot de passe">
                                        @if (!((passwordForm.get('confirmPassword')?.touched &&
                                        passwordForm.get('confirmPassword')?.invalid) || (passwordForm.touched &&
                                        passwordForm.hasError('mismatch')))) {
                                        <button type="button" (click)="togglePasswordVisibility('confirm')"
                                            class="btn-toggle-pass" tabindex="-1">
                                            <i class="bi" [class.bi-eye]="!showConfirmPassword()"
                                                [class.bi-eye-slash]="showConfirmPassword()"></i>
                                        </button>
                                        }
                                    </div>
                                    @if ((passwordForm.get('confirmPassword')?.touched &&
                                    passwordForm.get('confirmPassword')?.invalid) || (passwordForm.touched &&
                                    passwordForm.hasError('mismatch'))) {
                                    <div class="invalid-feedback d-block mt-1">
                                        @if (passwordForm.get('confirmPassword')?.hasError('required')) {
                                        La confirmation est requise.
                                        } @else if (passwordForm.hasError('mismatch')) {
                                        Les mots de passe ne correspondent pas.
                                        }
                                    </div>
                                    }
                                </div>
                            </div>
                            <div class="mt-4 pt-2 border-top">
                                <button type="submit" class="btn btn-outline-dark rounded-pill px-5 fw-bold py-2"
                                    [disabled]="passwordForm.invalid || isPasswordLoading()">
                                    @if (isPasswordLoading()) {
                                    <span class="spinner-border spinner-border-sm me-2" role="status"></span>Mise à
                                    jour...
                                    } @else {
                                    Mettre à jour le mot de passe
                                    }
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>